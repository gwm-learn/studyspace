# 概述
LTE层二协议既要承载用户平面的数据，也要承载控制平面的数据。   
用户平面协议栈包括以下这些：   
1. MAC 媒体接入控制层，主要执行调度、SDU复用与解复用。   
2. RLC 无线链路控制层，主要执行分段/级联、按序递交。   
3. PDCP 分组数据汇聚协议层，主要执行头压缩/解压缩、加密/解密。   

控制平面协议栈包括以下这些：   
1. PDCP子层(网络侧终止在eNB)，执行例如加密和完整性保护的功能。   
2. RLC和MAC子层(网络侧终止在eNB)，执行与用户面相同的功能。   
3. RRC(网络侧终止在eNB)，执行的功能有广播、寻呼、RRC连接管理、RB控制、移动性功能、UE测量上报和控制。   
4. NAS控制协议(网络侧终止在MME)，执行EPS承载管理、鉴权、ECM、IDLE移动性处理、ECM-IDLE下的寻呼发起、安全控制。   

# MAC

## MAC 结构和功能
E-UTRA提供了两种MAC实体，一种是位于UE的MAC实体，一种是位于E-UTRAN的MAC实体。两者执行不同的功能。

### UE MAC 实体
功能如下：   
1. 逻辑信道和传输信道之间的映射。   
2. 将来自一个或多个逻辑信道的MAC SDU 复用到一个传输块TB，通过传输信道发给物理层。   
3. 将来自一个或多个逻辑信道的MAC SDU 解复用，这些SDU来自于物理层通过传输信道发送的TB。   
4. 调度信息上报。   
5. 通过HARQ进行错误纠正。   
6. 通过动态调度在UE之间进行优先级操作。   
7. 同一个UE的逻辑信道间进行优先级的操作。   
8. 逻辑信道优先级排序。   
9. 传输格式选择。   

![UE MAC](./LTE/UE%20MAC.jpg)   

## 信道及信道映射
MAC 涉及的信道结构包括三方面内容：逻辑信道、传输信道、逻辑信道和传输信道之间的映射。传输信道是MAC层和物理层的业务接入点。逻辑信道是MAC层和RLC层的业务接入点。   

### 传输信道

#### 下行方向
1. BCH 广播信道   
2. DL-SCH 下行共享信道   
3. PCH 寻呼信道   
4. MCH 多播信道   

#### 上行方向
1. UL-SCH 上行共享信道   
2. RACH 随机接入信道   

### 逻辑信道

#### 控制信道
1. BCCH 广播控制信道   
2. PCCH 寻呼控制信道   
3. CCCH 公共控制信道   
4. MCCH 多播控制信道   
5. DCCH 专用控制信道   

#### 业务信道
1. DTCH 专用业务信道   
2. MTCH 多播业务信道   

## 随机接入过程

## 数据传输

## 测量上报

# RLC

## RLC 结构和功能
RLC层由RRC层配置，其功能由RLC实体完成。eNB侧的每一个RLC实体，在UE侧都有其对等实体。   
RLC实体接收来自于高层的RLC SDU，或将RLC SDU 提交给高层；通过下层发送RLC PSU实体给其对等实体，或通过下层接收来自其对等实体RLC PDU。RLC实体与高层的数据交互通过服务接入点SAP完成，与下层的数据交互通过信道完成。   
RLC实体分为三种类型：透明模式(TM)、非确认模式(UM)、确认模式(AM)。   

![RLC 结构图](./LTE/RLC%20%E7%BB%93%E6%9E%84%E5%9B%BE.jpg)   

功能如下：   
1. 高层PDU传输   
2. 对RLC SDU 的级联、分段和重组   
3. 对RLC 数据PDU 的重分段   
4. 对高层PDU的顺序递交   
5. 重复检测   
6. RLC SDU 丢弃   
7. 复位   
8. 协议错误检测   

# PDCP

## PDCP 结构
![PDCP 结构](./LTE/PDCP%20%E7%BB%93%E6%9E%84.jpg)   

## 功能
1. 基于ROHC协议对IP数据流进行头压缩/解压缩   
2. 传输数据   
3. 维护PDCP序号   
4. 下层重建时，顺序递交上层PDU   
5. 下层重建时，对映射到AM模式的RB的下层SDU进行重复排除   
6. 对用户平面和控制平面的数据进行加密和解密处理   
7. 对控制平面的数据进行完整性保护和完整性验证   
8. 基于定时器的丢弃   
9. 重复数据丢弃   

# RRC
注：RRC不属于层2，属于层3   

## 主要业务和功能
1. 非接入层相关系统信息的广播，接入层相关系统信息的广播   
2. 寻呼   
3. 建立、维护和释放UE与E-UTRAN之间的RRC连接   
4. 包括密钥管理的安全功能   
5. 建立、配置、维护和释放点对点的无线承载   
6. 移动性功能   
7. MBMS业务的通知   
8. Qos管理功能   
9. NAS消息的传输   


